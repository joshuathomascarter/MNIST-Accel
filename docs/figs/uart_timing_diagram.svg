<?xml version="1.0" encoding="utf-8"?>
<!-- Comprehensive UART packet protocol diagram with timing and bit-level detail -->
<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="600" viewBox="0 0 1200 600">
  <style>
    .lane { stroke:#cccccc; stroke-width:1; }
    .text { font-family: 'Segoe UI', Arial, sans-serif; font-size:11px; fill:#111; }
    .title { font-family: 'Segoe UI', Arial, sans-serif; font-size:16px; font-weight:700; fill:#1f1f1f; }
    .subtitle { font-family: 'Segoe UI', Arial, sans-serif; font-size:13px; font-weight:600; fill:#444; }
    .packet { fill:#e8f4ff; stroke:#1f77b4; stroke-width:2; rx:6; }
    .field { fill:#fff; stroke:#666; stroke-width:1.5; font-size:10px; }
    .sync-field { fill:#ffe0b3; stroke:#ff7f0e; stroke-width:1.5; }
    .crc-field { fill:#d4edda; stroke:#2ca02c; stroke-width:1.5; }
    .timing-line { stroke:#333; stroke-width:1.5; fill:none; }
    .bit-high { fill:#4CAF50; }
    .bit-low { fill:#f44336; }
  </style>

  <!-- Title -->
  <text x="50" y="35" class="title">ACCEL-v1 UART Protocol: Packet Structure and Timing</text>
  <text x="50" y="55" class="subtitle">115200 baud, 8N1 framing with CRC error detection</text>

  <!-- Packet structure diagram -->
  <g transform="translate(50,80)">
    <text x="0" y="20" class="subtitle">Packet Structure (byte-level)</text>
    
    <!-- Packet container -->
    <rect x="50" y="40" width="900" height="80" class="packet"/>
    
    <!-- Field divisions with enhanced styling -->
    <rect x="70" y="50" width="80" height="60" class="sync-field"/>
    <text x="110" y="70" text-anchor="middle" class="text" font-weight="700">SYNC0</text>
    <text x="110" y="85" text-anchor="middle" class="text">0xA5</text>
    <text x="110" y="100" text-anchor="middle" class="text" style="font-size:9px">(165)</text>
    
    <rect x="150" y="50" width="80" height="60" class="sync-field"/>
    <text x="190" y="70" text-anchor="middle" class="text" font-weight="700">SYNC1</text>
    <text x="190" y="85" text-anchor="middle" class="text">0x5A</text>
    <text x="190" y="100" text-anchor="middle" class="text" style="font-size:9px">(90)</text>
    
    <rect x="230" y="50" width="80" height="60" class="field"/>
    <text x="270" y="70" text-anchor="middle" class="text" font-weight="700">LENGTH</text>
    <text x="270" y="85" text-anchor="middle" class="text">N bytes</text>
    <text x="270" y="100" text-anchor="middle" class="text" style="font-size:9px">(0-255)</text>
    
    <rect x="310" y="50" width="80" height="60" class="field"/>
    <text x="350" y="70" text-anchor="middle" class="text" font-weight="700">COMMAND</text>
    <text x="350" y="85" text-anchor="middle" class="text">0x01/0x02</text>
    <text x="350" y="100" text-anchor="middle" class="text" style="font-size:9px">WR/RD</text>
    
    <rect x="390" y="50" width="450" height="60" class="field"/>
    <text x="615" y="70" text-anchor="middle" class="text" font-weight="700">PAYLOAD</text>
    <text x="615" y="85" text-anchor="middle" class="text">ADDRESS (4 bytes LE) + DATA (0-251 bytes)</text>
    <text x="615" y="100" text-anchor="middle" class="text" style="font-size:9px">CSR writes, memory transfers, responses</text>
    
    <rect x="840" y="50" width="80" height="60" class="crc-field"/>
    <text x="880" y="70" text-anchor="middle" class="text" font-weight="700">CRC8</text>
    <text x="880" y="85" text-anchor="middle" class="text">Checksum</text>
    <text x="880" y="100" text-anchor="middle" class="text" style="font-size:9px">Poly: 0x07</text>
    
    <!-- Byte boundaries -->
    <line x1="150" y1="40" x2="150" y2="120" stroke="#666" stroke-width="1" stroke-dasharray="3,3"/>
    <line x1="230" y1="40" x2="230" y2="120" stroke="#666" stroke-width="1" stroke-dasharray="3,3"/>
    <line x1="310" y1="40" x2="310" y2="120" stroke="#666" stroke-width="1" stroke-dasharray="3,3"/>
    <line x1="390" y1="40" x2="390" y2="120" stroke="#666" stroke-width="1" stroke-dasharray="3,3"/>
    <line x1="840" y1="40" x2="840" y2="120" stroke="#666" stroke-width="1" stroke-dasharray="3,3"/>
  </g>

  <!-- Bit-level timing for one byte -->
  <g transform="translate(50,200)">
    <text x="0" y="20" class="subtitle">Bit-Level Timing (8N1 framing, LSB first)</text>
    
    <!-- Time axis -->
    <line x1="50" y1="50" x2="850" y2="50" class="timing-line"/>
    
    <!-- Bit periods for SYNC0 (0xA5 = 10100101) -->
    <text x="25" y="50" class="text" text-anchor="end">TX</text>
    
    <!-- Start bit -->
    <rect x="80" y="30" width="60" height="40" class="bit-low"/>
    <text x="110" y="50" text-anchor="middle" class="text" fill="white" font-weight="700">0</text>
    <text x="110" y="80" text-anchor="middle" class="text" style="font-size:9px">START</text>
    
    <!-- Data bits (LSB first: 1-0-1-0-0-1-0-1) -->
    <rect x="140" y="30" width="60" height="40" class="bit-high"/>
    <text x="170" y="50" text-anchor="middle" class="text" fill="white" font-weight="700">1</text>
    <text x="170" y="80" text-anchor="middle" class="text" style="font-size:9px">D0</text>
    
    <rect x="200" y="30" width="60" height="40" class="bit-low"/>
    <text x="230" y="50" text-anchor="middle" class="text" fill="white" font-weight="700">0</text>
    <text x="230" y="80" text-anchor="middle" class="text" style="font-size:9px">D1</text>
    
    <rect x="260" y="30" width="60" height="40" class="bit-high"/>
    <text x="290" y="50" text-anchor="middle" class="text" fill="white" font-weight="700">1</text>
    <text x="290" y="80" text-anchor="middle" class="text" style="font-size:9px">D2</text>
    
    <rect x="320" y="30" width="60" height="40" class="bit-low"/>
    <text x="350" y="50" text-anchor="middle" class="text" fill="white" font-weight="700">0</text>
    <text x="350" y="80" text-anchor="middle" class="text" style="font-size:9px">D3</text>
    
    <rect x="380" y="30" width="60" height="40" class="bit-low"/>
    <text x="410" y="50" text-anchor="middle" class="text" fill="white" font-weight="700">0</text>
    <text x="410" y="80" text-anchor="middle" class="text" style="font-size:9px">D4</text>
    
    <rect x="440" y="30" width="60" height="40" class="bit-high"/>
    <text x="470" y="50" text-anchor="middle" class="text" fill="white" font-weight="700">1</text>
    <text x="470" y="80" text-anchor="middle" class="text" style="font-size:9px">D5</text>
    
    <rect x="500" y="30" width="60" height="40" class="bit-low"/>
    <text x="530" y="50" text-anchor="middle" class="text" fill="white" font-weight="700">0</text>
    <text x="530" y="80" text-anchor="middle" class="text" style="font-size:9px">D6</text>
    
    <rect x="560" y="30" width="60" height="40" class="bit-high"/>
    <text x="590" y="50" text-anchor="middle" class="text" fill="white" font-weight="700">1</text>
    <text x="590" y="80" text-anchor="middle" class="text" style="font-size:9px">D7</text>
    
    <!-- Stop bit -->
    <rect x="620" y="30" width="60" height="40" class="bit-high"/>
    <text x="650" y="50" text-anchor="middle" class="text" fill="white" font-weight="700">1</text>
    <text x="650" y="80" text-anchor="middle" class="text" style="font-size:9px">STOP</text>
    
    <text x="50" y="110" class="text">SYNC0 byte: 0xA5 = 10100101 binary (transmitted as: START-1-0-1-0-0-1-0-1-STOP)</text>
    <text x="50" y="130" class="text">Bit time: 1/115200 ≈ 8.68 μs per bit, total byte time ≈ 86.8 μs</text>
  </g>

  <!-- Example packet breakdown -->
  <g transform="translate(50,360)">
    <text x="0" y="20" class="subtitle">Example: CSR Write Command</text>
    
    <rect x="0" y="40" width="1100" height="140" fill="#f8f9fa" stroke="#dee2e6" rx="8"/>
    
    <text x="20" y="65" class="text" font-weight="700">Command: Write DIMS_M register (addr=0x04) with value 8</text>
    
    <text x="20" y="90" class="text">Raw bytes: A5 5A 08 01 04 00 00 00 08 00 00 00 42</text>
    <text x="20" y="110" class="text">Breakdown:</text>
    <text x="40" y="130" class="text">• SYNC0=0xA5, SYNC1=0x5A (frame markers)</text>
    <text x="40" y="150" class="text">• LENGTH=0x08 (8 payload bytes), COMMAND=0x01 (WRITE)</text>
    <text x="40" y="170" class="text">• PAYLOAD: 04 00 00 00 (addr=0x04, little-endian) + 08 00 00 00 (value=8, little-endian)</text>
  </g>

  <!-- Protocol state machine -->
  <g transform="translate(650,360)">
    <text x="0" y="20" class="subtitle">Receiver State Machine</text>
    
    <rect x="0" y="40" width="400" height="140" fill="#fff8dc" stroke="#d6b656" rx="8"/>
    
    <text x="20" y="65" class="text">1. Hunt for SYNC0 (0xA5) in byte stream</text>
    <text x="20" y="85" class="text">2. Verify next byte is SYNC1 (0x5A)</text>
    <text x="20" y="105" class="text">3. Read LENGTH byte (N)</text>
    <text x="20" y="125" class="text">4. Read COMMAND + N payload bytes</text>
    <text x="20" y="145" class="text">5. Read CRC8 and validate</text>
    <text x="20" y="165" class="text">6. If valid: process command; else: resync</text>
  </g>
</svg>
